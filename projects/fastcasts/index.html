<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <script data-goatcounter="https://jacobwxyz.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <script async src="https://storage.googleapis.com/al-web-sdk/al.min.js"></script> <script> window.ALSDK = window.ALSDK || {detectWallet:async()=>{return new Promise(async(resolve)=>{document.addEventListener('absolutelabs.walletDetected',(e)=>{resolve(e.detail)})})}}; ALSDK.siteId = '23ee1cfc'; </script> <link rel=icon  href="/assets/favicon.png"> <title>FastCasts</title> <header> <div class=blog-name ><a href="/">Jacob Wood</a></div> <nav> <ul> <li><a href="/projects/">Projects</a> <li><a href="/books/">Books</a> <li><a href="/cv/">CV</a> <li><a href="/now/">Now</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content ><div class=note ><div class=title >Objective</div> <div class=content >Get sped up podcasts on a Garmin watch.</div></div> <p>The <a href="https://www.garmin.com/en-US/p/612476">Garmin 645 Music</a> watch is a running watch with 3.5 GB of on board media storage and Bluetooth capability. An impressive but limited set of apps is available to manage and play podcasts on the watch, most notably <a href="https://www.playrun.app/">playrun.app</a>. Unfortunately, there is no playback speed functionality built in to the watches audio player and it is really hard to go back to listening to podcasts at 1x speed. In this project we&#39;ll set up a podcast RSS mirror that sends out a sped-up version of all your favorite podcasts as they are released.</p> <p>Note - the result here is meant for personal use. Altering the audio content and re-distributing may be infringement of copyright.</p> <p>The results of this project can be found <a href="https://github.com/jacobwood27/032_fastaudiocasts">here</a>.</p> <h1 id=project ><a href="#project" class=header-anchor >Project</a></h1> <p>Here&#39;s the end goal we have in mind and the tools we can use to do all the heavy lifting:</p> <div class=im-100 ><img src="/projects/fastcasts/psuedo.svg" alt=""></div> <p>Our Python script is pretty simple. We&#39;ll start off by pulling in some libraries that allow us to deal with the local filesystem and manipulate XML files:</p> <pre><code class="Python hljs"><span class=hljs-keyword >import</span> os
<span class=hljs-keyword >import</span> xml.etree.ElementTree <span class=hljs-keyword >as</span> ET</code></pre> <p>Then we&#39;ll define what podcasts we want to mirror and the speedup factor we want to use for each. We need to locate the RSS feed for each podcast to know where to download from. The best way I found to locate the RSS feed is to look up the Podcast on <a href="https://www.podbean.com/">PodBean</a>, it shows the RSS feed just below the title:</p> <div class=im-60 ><img src="/projects/fastcasts/ctyler.png" alt=""></div> <p>We&#39;ll collect the podcast identifier, the show-specific speedup, and the rss feed into a list of tuples. I picked a few of the more prolific podcasts from among <a href="https://jacobw.xyz/projects/podcasts/">my favorites</a>.</p> <pre><code class="Python hljs">pods = [
    (<span class=hljs-string >&quot;80k&quot;</span>,    <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://feeds.feedburner.com/80000HoursPodcast&quot;</span>),
    (<span class=hljs-string >&quot;ezra&quot;</span>,   <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://feeds.simplecast.com/82FI35Px&quot;</span>),
    (<span class=hljs-string >&quot;lex&quot;</span>,    <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://lexfridman.com/feed/podcast/&quot;</span>),
    (<span class=hljs-string >&quot;rspeak&quot;</span>, <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://rationallyspeakingpodcast.libsyn.com/rss&quot;</span>),
    (<span class=hljs-string >&quot;tyler&quot;</span>,  <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://cowenconvos.libsyn.com/rss&quot;</span>),
    (<span class=hljs-string >&quot;econ&quot;</span>,   <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;http://files.libertyfund.org/econtalk/EconTalk.xml&quot;</span>),
    (<span class=hljs-string >&quot;mscape&quot;</span>, <span class=hljs-string >&quot;1.8&quot;</span>, <span class=hljs-string >&quot;https://rss.art19.com/sean-carrolls-mindscape&quot;</span>),
]</code></pre> <p>And then for each podcast we start by pulling in its feed as a .xml file, parsing it, and finding the latest &quot;item&quot; entry which contains the latest episode:</p> <pre><code class="Python hljs">os.system(<span class=hljs-string >&quot;wget &quot;</span> + pod[<span class=hljs-number >2</span>] + <span class=hljs-string >&quot; -O raw.xml&quot;</span>)

tree = ET.parse(<span class=hljs-string >&quot;raw.xml&quot;</span>)
root = tree.getroot()

ep = root.find(<span class=hljs-string >&#x27;./channel/item&#x27;</span>)</code></pre> <p>Then we can pull out some information about the episode:</p> <pre><code class="Python hljs">ep_id    = ep.find(<span class=hljs-string >&#x27;guid&#x27;</span>).text
ep_title = ep.find(<span class=hljs-string >&#x27;title&#x27;</span>).text
ep_audio = ep.find(<span class=hljs-string >&#x27;enclosure&#x27;</span>).attrib[<span class=hljs-string >&#x27;url&#x27;</span>]
ep_date  = ep.find(<span class=hljs-string >&#x27;pubDate&#x27;</span>).text</code></pre> <p>We&#39;ll make a name for the file out of the title &#40;minus any funny characters&#41; and specify its target directory as <code>./audio/podcastname/episodename.mp3</code>:</p> <pre><code class="Python hljs">file_name = <span class=hljs-string >&quot;&quot;</span>.join([c <span class=hljs-keyword >for</span> c <span class=hljs-keyword >in</span> ep_title <span class=hljs-keyword >if</span> c.isalpha() <span class=hljs-keyword >or</span> c.isdigit()]).rstrip() + <span class=hljs-string >&quot;.mp3&quot;</span>
full_file = os.path.join(<span class=hljs-string >&quot;audio&quot;</span>, pod[<span class=hljs-number >0</span>], file_name)</code></pre> <p>We can check if we already pulled this podcast by seeing if that file already exists. If not, let&#39;s download the audio and run it through ffmpeg to compress the tempo. I tried the different quality levels &#40;detailed <a href="https://trac.ffmpeg.org/wiki/Encode/MP3">here</a>&#41; and couldn&#39;t tell the difference between 1-6. A trained ear may disagree. Git file limits are 100MB, so quality 6, at an average bitrate of 115 kbit/s, should net <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mtext> MB</mtext><mo>÷</mo><mo stretchy=false >(</mo><mn>115</mn><mi mathvariant=normal >/</mi><mn>8</mn><mo stretchy=false >)</mo><mfrac><mtext>kB</mtext><mtext>s</mtext></mfrac><mo>=</mo><mn>1.93</mn><mtext> hours</mtext></mrow><annotation encoding="application/x-tex"> 100 \text{ MB} \div (115/8)\frac{\text{kB}}{\text{s}} = 1.93 \text{ hours}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class=mord >100</span><span class="mord text"><span class=mord > MB</span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >÷</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class=mopen >(</span><span class=mord >115/8</span><span class=mclose >)</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">s</span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">kB</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >1.93</span><span class="mord text"><span class=mord > hours</span></span></span></span></span> of sped up audio, or <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3.5</mn><mtext> hours</mtext></mrow><annotation encoding="application/x-tex">3.5 \text{ hours}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >3.5</span><span class="mord text"><span class=mord > hours</span></span></span></span></span> of original speed audio assuming 1.8x speed up. That should be sufficient compression to hold all but the longest episodes.</p> <pre><code class="Python hljs"><span class=hljs-keyword >if</span> <span class=hljs-keyword >not</span> os.path.exists(full_file):
    os.system(<span class=hljs-string >&quot;wget \&quot;&quot;</span> + ep_audio + <span class=hljs-string >&quot;\&quot; -O raw.mp3&quot;</span>)
    os.system(<span class=hljs-string >&quot;ffmpeg -i raw.mp3 -filter:a \&quot;atempo=&quot;</span> + pod[<span class=hljs-number >1</span>] + <span class=hljs-string >&quot;\&quot; -q:a 6 &quot;</span> + full_file)</code></pre> <p>Finally, we&#39;ll add the item to our existing feed.xml file. A minimal feed.xml looks like:</p> <pre><code class="XML hljs"><span class=hljs-tag >&lt;<span class=hljs-name >rss</span> <span class=hljs-attr >version</span>=<span class=hljs-string >&quot;2.0&quot;</span>&gt;</span>
  <span class=hljs-tag >&lt;<span class=hljs-name >channel</span>&gt;</span>
    <span class=hljs-tag >&lt;<span class=hljs-name >title</span>&gt;</span>Jacob&#x27;s 1.8<span class=hljs-tag >&lt;/<span class=hljs-name >title</span>&gt;</span>
    <span class=hljs-tag >&lt;<span class=hljs-name >language</span>&gt;</span>en-us<span class=hljs-tag >&lt;/<span class=hljs-name >language</span>&gt;</span>
    <span class=hljs-tag >&lt;<span class=hljs-name >description</span>&gt;</span>A few select podcasts preprocessed at 1.8x<span class=hljs-tag >&lt;/<span class=hljs-name >description</span>&gt;</span>
  <span class=hljs-tag >&lt;/<span class=hljs-name >channel</span>&gt;</span>
<span class=hljs-tag >&lt;/<span class=hljs-name >rss</span>&gt;</span></code></pre> <p>To add the new item we&#39;ll make a new XML element and insert it. The episode URL will come from the Github raw content link for this directory.</p> <pre><code class="Python hljs"><span class=hljs-comment >#Make the new XML item element</span>
new_item = ET.Element(<span class=hljs-string >&#x27;item&#x27;</span>)

new_title = ET.Element(<span class=hljs-string >&#x27;title&#x27;</span>)
new_title.text = pod[<span class=hljs-number >0</span>] + <span class=hljs-string >&quot; &quot;</span> + ep_title

new_enclosure = ET.Element(<span class=hljs-string >&#x27;enclosure&#x27;</span>, 
                            url=<span class=hljs-string >&quot;https://raw.githubusercontent.com/jacobwood27/032_fastaudiocasts/main/audio/&quot;</span> + pod[<span class=hljs-number >0</span>] + <span class=hljs-string >&quot;/&quot;</span> + file_name, 
                            length=<span class=hljs-built_in >str</span>(os.path.getsize(full_file)), 
                            <span class=hljs-built_in >type</span>=<span class=hljs-string >&quot;audio/mpeg&quot;</span>)

new_guid = ET.Element(<span class=hljs-string >&quot;guid&quot;</span>)
new_guid.text = ep_id + <span class=hljs-string >&quot;_1.8x&quot;</span>

new_pubdate = ET.Element(<span class=hljs-string >&quot;pubDate&quot;</span>)
new_pubdate.text = ep_date

new_item.append(new_title)
new_item.append(new_enclosure)
new_item.append(new_guid)
new_item.append(new_pubdate)

feed_chan.insert(<span class=hljs-number >3</span>, new_item) <span class=hljs-comment >#after title, language, and description</span>
feed.write(<span class=hljs-string >&#x27;feed.xml&#x27;</span>)</code></pre> <p>Run the Python script once, commit it all to Github &#40;or fork <a href="https://github.com/jacobwood27/032_fastaudiocasts">mine</a>&#41; and <a href="https://docs.github.com/en/pages/quickstart">enable Github Pages</a> for that directory and your RSS feed should be up and running&#33; You can test it easily by opening the feed in <a href="https://www.videolan.org/">VLC</a>.</p> <div class=im-60 ><img src="/projects/fastcasts/vlc_feed.png" alt=""></div> <p>To keep the feed up to date we want to run that Python script about once a day. Github Actions is a convenient set-it-and-forget-it way to do this. We&#39;ll add a new action to the repository and tell it to run every day at some specific time.</p> <pre><code class="YAML hljs"><span class=hljs-attr >name:</span> <span class=hljs-string >Get</span> <span class=hljs-string >New</span> <span class=hljs-string >Podcasts</span>

<span class=hljs-attr >on:</span>
  <span class=hljs-attr >schedule:</span>
    <span class=hljs-comment ># * is a special character in YAML so you have to quote this string</span>
    <span class=hljs-bullet >-</span> <span class=hljs-attr >cron:</span>  <span class=hljs-string >&#x27;30 5 * * *&#x27;</span>
  
  <span class=hljs-attr >workflow_dispatch:</span>

<span class=hljs-attr >jobs:</span>
  <span class=hljs-attr >build:</span>

    <span class=hljs-attr >runs-on:</span> <span class=hljs-string >ubuntu-latest</span>

    <span class=hljs-attr >steps:</span>
    <span class=hljs-bullet >-</span> <span class=hljs-attr >name:</span> <span class=hljs-string >Checkout</span> <span class=hljs-string >latest</span>
      <span class=hljs-attr >uses:</span> <span class=hljs-string >actions/checkout@v2</span>
    
    <span class=hljs-bullet >-</span> <span class=hljs-attr >name:</span> <span class=hljs-string >Set</span> <span class=hljs-string >up</span> <span class=hljs-string >Python</span> <span class=hljs-number >3.10</span>
      <span class=hljs-attr >uses:</span> <span class=hljs-string >actions/setup-python@v2</span>
      <span class=hljs-attr >with:</span>
        <span class=hljs-attr >python-version:</span> <span class=hljs-string >&quot;3.10&quot;</span>
        
    <span class=hljs-bullet >-</span> <span class=hljs-attr >name:</span> <span class=hljs-string >Set</span> <span class=hljs-string >up</span> <span class=hljs-string >ffmpeg</span>
      <span class=hljs-attr >uses:</span> <span class=hljs-string >FedericoCarboni/setup-ffmpeg@v1.1.0</span>
      
    <span class=hljs-bullet >-</span> <span class=hljs-attr >name:</span> <span class=hljs-string >Run</span> <span class=hljs-string >Script</span>
      <span class=hljs-attr >run:</span> <span class=hljs-string >|
        python make_rss.py
</span>        
    <span class=hljs-bullet >-</span> <span class=hljs-attr >name:</span> <span class=hljs-string >Commit</span> <span class=hljs-string >and</span> <span class=hljs-string >Push</span>
      <span class=hljs-attr >run:</span> <span class=hljs-string >|
          git config --global user.name &quot;github-actions[bot]&quot;
          git config --global user.email &quot;41898282+github-actions[bot]@users.noreply.github.com&quot;
          git add -A
          git commit --allow-empty -m &quot;Update&quot;
          git push</span></code></pre> <p>The last thing to do is <a href="https://www.playrun.app/blog/private-podcast">add</a> your new feed to the playrun.app &#40;or your player of choice&#41; interface and sync your watch. </p> <div class=im-60 ><img src="/projects/fastcasts/playrun_add.png" alt=""></div> <div class=im-60 ><img src="/projects/fastcasts/on_watch.png" alt=""></div> <h1 id=ingredients ><a href="#ingredients" class=header-anchor >Ingredients</a></h1> <ul> <li><p><a href="https://www.playrun.app/">playrun</a> - Garmin App to sync and play podcast feeds</p> <li><p><a href="https://github.com/features/actions">Github Actions</a> - Github feature to automate a software workflow</p> <li><p><a href="https://pages.github.com/">Github Pages</a> - Github feature to host a website from a repository</p> <li><p><a href="https://www.python.org/">Python 3.9.7</a> - Scripting language</p> <li><p><a href="https://www.ffmpeg.org/">ffmpeg 4.4-6</a> - Media conversion tool that can do anything</p> <li><p><a href="https://github.com/marketplace/actions/setup-ffmpeg">ffmpeg Github Action</a> - Github action to leverage ffmpeg in your workflow</p> </ul> <div class=page-foot > <div class=copyright > <a href="mailto:mail@jacobw.xyz" class="fa fa-envelope"></a> <a href="https://github.com/jacobwood27" class="fa fa-github"></a> <br> <br> Last modified: June 19, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>