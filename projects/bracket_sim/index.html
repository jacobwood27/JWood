<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <script data-goatcounter="https://jacobwxyz.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <script async src="https://storage.googleapis.com/al-web-sdk/al.min.js"></script> <script> window.ALSDK = window.ALSDK || {detectWallet:async()=>{return new Promise(async(resolve)=>{document.addEventListener('absolutelabs.walletDetected',(e)=>{resolve(e.detail)})})}}; ALSDK.siteId = '23ee1cfc'; </script> <link rel=icon  href="/assets/favicon.png"> <title>Bracket Simulation</title> <header> <div class=blog-name ><a href="/">Jacob Wood</a></div> <nav> <ul> <li><a href="/projects/">Projects</a> <li><a href="/books/">Books</a> <li><a href="/cv/">CV</a> <li><a href="/now/">Now</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content ><div class=note ><div class=title >Objective</div> <div class=content >Tackle a semi-tractable domain with predictive algorithms and implement a publically available application.</div></div> <p>There are 13 games in the NFL playoffs, which means there are 2^13 &#61; 8192 unique ways it can play out. My group of friends plays a small bracket prediction competition each year. The goal is to predict a bracket &#40;select 1 of the 8192 unique possible outcomes&#41; and get more games right than everyone else &#40;with some extra weight for the later games&#41;.</p> <img src="/projects/bracket_sim/2022bracket-sea.webp" alt=""> <p>There must exist a single bracket that has the highest probability of winning the competition. The best bracket has to balance picking likely winners against picking brackets that are differentiated from the competition to derive an edge. To do this, we&#39;ll leverage everything we know about our friends&#39; behavior and the brackets they are likely to pick.</p> <p>You can find the finished product <a href="http://nflbracket.xyz/">here</a> and all the code is <a href="https://github.com/jacobwood27/052_bracketsim2">here</a>.</p> <h1 id=predicting_the_actual_outcomes ><a href="#predicting_the_actual_outcomes" class=header-anchor >Predicting the Actual Outcomes</a></h1> <p>The first step for us is predicting the actual outcomes of the NFL playoff games to the best of our abilities. Luckily, <a href="https://fivethirtyeight.com/">FiveThirtyEight</a> has us covered. </p> <p>538 has put together an <a href="https://en.wikipedia.org/wiki/Elo_rating_system">ELO</a> model that can be used to predict the likelihood of any team winning a hypothetical matchup against any other team. <a href="https://fivethirtyeight.com/methodology/how-our-nfl-predictions-work/">The model</a> is capable of incorporating unique circumstances like location &#40;and associated travel distance&#41;, whether or not a team is rested, whether or not the game is a playoff game, and the current injury status of a team&#39;s top QB.</p> <p>To model out all the possible outcomes all we need to read in is thus:</p> <ul> <li><p>Each team&#39;s seed</p> <li><p>Each team&#39;s &#40;QB adjusted&#41; ELO rating</p> <li><p>A location associated with each team</p> <li><p>The Superbowl location</p> </ul> <p>For the 2022-2023 playoffs:</p> <pre><code class="julia hljs">TEAMS = <span class=hljs-built_in >Dict</span>(
    <span class=hljs-number >1</span>  =&gt; ( <span class=hljs-string >&quot;KC&quot;</span>, <span class=hljs-number >1702</span>,    (<span class=hljs-number >39.048914</span>, -<span class=hljs-number >94.484039</span>)),
    <span class=hljs-number >2</span>  =&gt; (<span class=hljs-string >&quot;BUF&quot;</span>, <span class=hljs-number >1708</span>,    (<span class=hljs-number >42.773739</span>, -<span class=hljs-number >78.786978</span>)),
    <span class=hljs-number >3</span>  =&gt; (<span class=hljs-string >&quot;CIN&quot;</span>, <span class=hljs-number >1666</span>,    (<span class=hljs-number >39.095442</span>, -<span class=hljs-number >84.516039</span>)),
    <span class=hljs-number >4</span>  =&gt; (<span class=hljs-string >&quot;JAC&quot;</span>, <span class=hljs-number >1540</span>,    (<span class=hljs-number >30.323674</span>, -<span class=hljs-number >81.637328</span>)),
    <span class=hljs-number >5</span>  =&gt; (<span class=hljs-string >&quot;LAC&quot;</span>, <span class=hljs-number >1543</span>,    (<span class=hljs-number >33.952815</span>,-<span class=hljs-number >118.340306</span>)),
    <span class=hljs-number >6</span>  =&gt; (<span class=hljs-string >&quot;BAL&quot;</span>, <span class=hljs-number >1608</span>-<span class=hljs-number >92</span>, (<span class=hljs-number >39.277969</span>, -<span class=hljs-number >76.622767</span>)),
    <span class=hljs-number >7</span>  =&gt; (<span class=hljs-string >&quot;MIA&quot;</span>, <span class=hljs-number >1509</span>-<span class=hljs-number >160</span>,(<span class=hljs-number >25.956799</span>, -<span class=hljs-number >80.240191</span>)),

    <span class=hljs-number >11</span> =&gt; (<span class=hljs-string >&quot;PHI&quot;</span>, <span class=hljs-number >1650</span>,    (<span class=hljs-number >39.900775</span>, -<span class=hljs-number >75.167453</span>)),
    <span class=hljs-number >12</span> =&gt; ( <span class=hljs-string >&quot;SF&quot;</span>, <span class=hljs-number >1700</span>-<span class=hljs-number >80</span>, (<span class=hljs-number >37.713486</span>,-<span class=hljs-number >122.386256</span>)),
    <span class=hljs-number >13</span> =&gt; (<span class=hljs-string >&quot;MIN&quot;</span>, <span class=hljs-number >1553</span>,    (<span class=hljs-number >44.973805</span>, -<span class=hljs-number >93.259297</span>)),
    <span class=hljs-number >14</span> =&gt; ( <span class=hljs-string >&quot;TB&quot;</span>, <span class=hljs-number >1504</span>,    (<span class=hljs-number >27.975967</span>, -<span class=hljs-number >82.503350</span>)),
    <span class=hljs-number >15</span> =&gt; (<span class=hljs-string >&quot;DAL&quot;</span>, <span class=hljs-number >1616</span>,    (<span class=hljs-number >32.747778</span>, -<span class=hljs-number >97.092778</span>)),
    <span class=hljs-number >16</span> =&gt; (<span class=hljs-string >&quot;NYG&quot;</span>, <span class=hljs-number >1503</span>,    (<span class=hljs-number >40.813303</span>, -<span class=hljs-number >74.074500</span>)),
    <span class=hljs-number >17</span> =&gt; (<span class=hljs-string >&quot;SEA&quot;</span>, <span class=hljs-number >1463</span>,    (<span class=hljs-number >47.595153</span>, -<span class=hljs-number >122.33162</span>)),
)

SUPERBOWL_LOC = (<span class=hljs-number >33.525890</span>, -<span class=hljs-number >112.261958</span>)</code></pre> <h3 id=structure ><a href="#structure" class=header-anchor >Structure</a></h3> <p>The NFL playoffs have an unfortunately complicated playoff structure due to bye weeks. We have to think a bit about how we want to lay things out.</p> <p>I chose to store the game tree as a linear vector and all the logical operations occur on the index into the vector. This kept the storage requirements as small as possible at the expense of some off-by-1 error debugging. The game tree can be drawn like this:</p> <div class=im-100 ><img src="/projects/bracket_sim/game_tree.svg" alt=""></div> <p>After we have the entire game tree stored we can easily index into it. For example, we can say: &quot;if I am at game 6 I know games 1 and 3 have occurred, the home teams were SF and JAC, and the winners were SEA and JAC.&quot;</p> <p>In the end we will have 8191 games in the gametree, and 8192 possible outcomes.</p> <h3 id=implementation ><a href="#implementation" class=header-anchor >Implementation</a></h3> <p>The complexity in building up the gametree comes from the way the NFL handles bye weeks and seeding. In each round, the highest seed must play the lowest seed, the 2nd highest plays the 2nd lowest, etc. To capture this we need a bit of logic in each round. </p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> get_teams(game_i, T)
    
    <span class=hljs-keyword >if</span>     game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >1</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >12</span>,<span class=hljs-number >17</span>) <span class=hljs-comment ># SF v SEA</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >2</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >4</span>,<span class=hljs-number >5</span>)   <span class=hljs-comment >#JAC v LAC </span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >3</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >2</span>,<span class=hljs-number >7</span>)   <span class=hljs-comment >#BUF v MIA</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >4</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >13</span>,<span class=hljs-number >16</span>) <span class=hljs-comment >#MIN v NYG</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >5</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >3</span>,<span class=hljs-number >6</span>)   <span class=hljs-comment >#CIN v BAL</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >6</span>
        <span class=hljs-keyword >return</span> (<span class=hljs-number >14</span>,<span class=hljs-number >15</span>) <span class=hljs-comment ># TB v DAL</span>

    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >7</span>
        opp = maximum([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,<span class=hljs-number >5</span>]])
        <span class=hljs-keyword >return</span> (<span class=hljs-number >1</span>,opp)  <span class=hljs-comment ># KC v lowest seed from 2nd, 3rd, and 5th game</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >8</span>
        opp = maximum([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >1</span>,<span class=hljs-number >4</span>,<span class=hljs-number >6</span>]])
        <span class=hljs-keyword >return</span> (<span class=hljs-number >11</span>,opp) <span class=hljs-comment >#PHI v lowest seed from 1st, 4th, and 6th game</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >9</span>
        tms = sort([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >1</span>,<span class=hljs-number >4</span>,<span class=hljs-number >6</span>]])
        <span class=hljs-keyword >return</span> (tms[<span class=hljs-number >1</span>],tms[<span class=hljs-number >2</span>]) <span class=hljs-comment ># highest seed from [1,4,6] vs 2nd highest</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >10</span>
        tms = sort([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >2</span>,<span class=hljs-number >3</span>,<span class=hljs-number >5</span>]])
        <span class=hljs-keyword >return</span> (tms[<span class=hljs-number >1</span>],tms[<span class=hljs-number >2</span>]) <span class=hljs-comment ># highest seed from [2,3,5] vs 2nd highest</span>

    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >11</span>
        tms = sort([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >8</span>,<span class=hljs-number >9</span>]])
        <span class=hljs-keyword >return</span> (tms[<span class=hljs-number >1</span>],tms[<span class=hljs-number >2</span>]) <span class=hljs-comment ># highest seed from [8,9] vs 2nd highest</span>
    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >12</span>
        tms = sort([winner(game_i,rnd,T) <span class=hljs-keyword >for</span> rnd <span class=hljs-keyword >in</span> [<span class=hljs-number >7</span>,<span class=hljs-number >10</span>]])
        <span class=hljs-keyword >return</span> (tms[<span class=hljs-number >1</span>],tms[<span class=hljs-number >2</span>]) <span class=hljs-comment ># highest seed from [7,10] vs 2nd highest</span>

    <span class=hljs-keyword >elseif</span> game_i &lt; <span class=hljs-number >2</span>^<span class=hljs-number >13</span>
        <span class=hljs-keyword >return</span> (winner(game_i,<span class=hljs-number >11</span>,T), winner(game_i,<span class=hljs-number >12</span>,T)) <span class=hljs-comment ># AFC champ v NFC champ</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre> <p>After putting together the gametree we can assign probabilities to each outcome using the ELO scores referenced above. We can determine the probability of each branch by taking the product of each individual game probability. This results in 8192 probabilities that sum up to 1. </p> <p>The most likely outcome &#40;the favorites win every game&#41; is not very likely at all, it is expected to occur only ~1&#37; of the time. The least likely outcome &#40;underdogs all the way&#41; has a whopping 1:500 million chance of occuring.</p> <img src="/projects/bracket_sim/outcome_probs.svg" alt=""> <h1 id=predicting_friends ><a href="#predicting_friends" class=header-anchor >Predicting Friends</a></h1> <p>One option we have for predicting how our friends are going to fill out their bracket is to explicitly fill out a bracket as we expect them to. But the problem there is that the solution is not very robust. What if we get a key game wrong? We might want to fill out a second bracket, and a third. And a fourth. And then probably assign some weights to how likely we think each choice is. This approach seemed intractable to me. </p> <p>Instead, we can assume each friend utilizes a strategy for selecting their brackets. Or, if we are less confident, put some credences on how likely they are to use each option from a menu of strategies.</p> <p>The strategies I came up with to implement attempted to mimic my own decision making. They are:</p> <ul> <li><p>Random: every game is a coin toss</p> <li><p>Chalk: pick all the favorites</p> <li><p>Pick Underdog: pick the underdog a set number of times</p> <li><p>Favorite Team: make sure one team goes all the way</p> <li><p>Tossup: close games are as good as random, heavy favorites win</p> <li><p>Extremify: probability of picking is based on probability of winning </p> </ul> <h1 id=ingredients ><a href="#ingredients" class=header-anchor >Ingredients</a></h1> <ul> <li><p><a href="https://fivethirtyeight.com/">FiveThirtyEight</a></p> </ul> <div class=page-foot > <div class=copyright > <a href="mailto:mail@jacobw.xyz" class="fa fa-envelope"></a> <a href="https://github.com/jacobwood27" class="fa fa-github"></a> <br> <br> Last modified: January 07, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>